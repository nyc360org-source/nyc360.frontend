<div class="selection-container">
    <a routerLink="/" class="landing-btn">
        <i class="bi bi-house-door"></i> Back to Home
    </a>

    <div class="brand-panel">
        <div class="brand-content">
            <div class="logo-box">
                <span class="logo-text">NYC<span class="highlight">360</span></span>
            </div>
            <h1 class="brand-title">Welcome,<br>Visitor.</h1>
            <p class="brand-subtitle">Experience the city like never before. Create your visitor profile.</p>
        </div>
        <div class="glow-circle"></div>
    </div>

    <div class="choices-panel">
        <div class="content-wrapper form-container">

            <button class="btn-back" routerLink="/auth/register">
                <i class="bi bi-arrow-left"></i> Back to Selection
            </button>

            <div class="header-section form-header">
                <h2 class="main-question">Visitor Registration</h2>
                <p class="sub-text">Tell us about your trip to personalize your experience.</p>
            </div>

            <form [formGroup]="form" (ngSubmit)="onSubmit()">

                <div class="form-fields">
                    <div class="row-group">
                        <div class="form-group">
                            <label>First Name</label>
                            <div class="input-wrapper">
                                <i class="bi bi-person"></i>
                                <input type="text" formControlName="FirstName" placeholder="John"
                                    [class.is-invalid]="isFieldInvalid('FirstName')">
                            </div>
                            <div *ngIf="isFieldInvalid('FirstName')" class="invalid-feedback d-block">Required (min 2
                                chars).</div>
                        </div>

                        <div class="form-group">
                            <label>Last Name</label>
                            <div class="input-wrapper">
                                <i class="bi bi-person"></i>
                                <input type="text" formControlName="LastName" placeholder="Doe"
                                    [class.is-invalid]="isFieldInvalid('LastName')">
                            </div>
                            <div *ngIf="isFieldInvalid('LastName')" class="invalid-feedback d-block">Required.</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Username</label>
                        <div class="input-wrapper">
                            <i class="bi bi-at"></i>
                            <input type="text" formControlName="Username" placeholder="johndoe_explorer"
                                [class.is-invalid]="isFieldInvalid('Username')">
                        </div>
                        <div *ngIf="isFieldInvalid('Username')" class="invalid-feedback d-block">Required (min 4 chars).
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Email Address</label>
                        <div class="input-wrapper">
                            <i class="bi bi-envelope"></i>
                            <input type="email" formControlName="Email" placeholder="email@example.com"
                                [class.is-invalid]="isFieldInvalid('Email')">
                        </div>
                        <div *ngIf="isFieldInvalid('Email')" class="invalid-feedback d-block">Invalid email.</div>
                    </div>

                    <div class="form-group">
                        <label>Password</label>
                        <div class="input-wrapper">
                            <i class="bi bi-lock"></i>
                            <input type="password" formControlName="Password" placeholder="Strong password"
                                [class.is-invalid]="isFieldInvalid('Password')">
                        </div>
                        <div *ngIf="isFieldInvalid('Password')" class="invalid-feedback d-block">Min 6 chars, 1 digit, 1
                            lowercase.
                        </div>
                    </div>

                    <div class="row-group">
                        <div class="form-group">
                            <label>City of Origin</label>
                            <div class="input-wrapper">
                                <i class="bi bi-geo-alt"></i>
                                <input type="text" formControlName="CityOfOrigin" placeholder="Paris"
                                    [class.is-invalid]="isFieldInvalid('CityOfOrigin')">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Country of Origin</label>
                            <div class="input-wrapper">
                                <i class="bi bi-globe"></i>
                                <input type="text" formControlName="CountryOfOrigin" placeholder="France"
                                    [class.is-invalid]="isFieldInvalid('CountryOfOrigin')">
                            </div>
                        </div>
                    </div>

                    <div class="row-group">
                        <div class="form-group">
                            <label>Purpose of Visit</label>
                            <div class="input-wrapper">
                                <i class="bi bi-briefcase"></i>
                                <select formControlName="VisitPurpose"
                                    [class.is-invalid]="isFieldInvalid('VisitPurpose')">
                                    <option [ngValue]="null" disabled>Select Purpose</option>
                                    <option *ngFor="let p of visitPurposes" [ngValue]="p.value">{{ p.label }}</option>
                                </select>
                            </div>
                            <div *ngIf="isFieldInvalid('VisitPurpose')" class="invalid-feedback d-block">Required.</div>
                        </div>

                        <div class="form-group">
                            <label>Length of Stay</label>
                            <div class="input-wrapper">
                                <i class="bi bi-calendar-event"></i>
                                <select formControlName="LengthOfStay"
                                    [class.is-invalid]="isFieldInvalid('LengthOfStay')">
                                    <option [ngValue]="null" disabled>Select Duration</option>
                                    <option *ngFor="let l of lengthsOfStay" [ngValue]="l.value">{{ l.label }}</option>
                                </select>
                            </div>
                            <div *ngIf="isFieldInvalid('LengthOfStay')" class="invalid-feedback d-block">Required.</div>
                        </div>
                    </div>

                    <!-- Interests -->
                    <div class="interests-section">
                        <label class="section-label">Select Interests <span class="req">*</span></label>
                        <div class="chips-grid">
                            <div class="interest-chip" *ngFor="let interest of interestsList"
                                [class.active]="isSelected(interest.id)" (click)="toggleInterest(interest.id)"
                                [style.--chip-color]="interest.color">
                                <i class="bi" [ngClass]="interest.icon"></i>
                                <span>{{ interest.name }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Preferences Toggles -->
                    <div class="preferences-section">
                        <h4 class="pref-header">Preferences</h4>

                        <div class="pref-item">
                            <div class="pref-text">
                                <span class="pref-title">Event & Culture Recommendations</span>
                                <span class="pref-desc">Get personalized suggestions based on your interests.</span>
                            </div>
                            <label class="switch">
                                <input type="checkbox" formControlName="ReceiveEventAndCultureRecommendations">
                                <span class="slider round"></span>
                            </label>
                        </div>

                        <div class="pref-item">
                            <div class="pref-text">
                                <span class="pref-title">Location Based Suggestions</span>
                                <span class="pref-desc">Allow us to suggest places near you.</span>
                            </div>
                            <label class="switch">
                                <input type="checkbox" formControlName="EnableLocationBasedSuggestions">
                                <span class="slider round"></span>
                            </label>
                        </div>

                        <div class="pref-item">
                            <div class="pref-text">
                                <span class="pref-title">Save Places & Events</span>
                                <span class="pref-desc">Automatically create a guide from your saved items.</span>
                            </div>
                            <label class="switch">
                                <input type="checkbox" formControlName="SavePlacesEventsGuides">
                                <span class="slider round"></span>
                            </label>
                        </div>

                        <div class="pref-item">
                            <div class="pref-text">
                                <span class="pref-title">Discoverable Profile</span>
                                <span class="pref-desc">Let other travelers or locals find you.</span>
                            </div>
                            <label class="switch">
                                <input type="checkbox" formControlName="DiscoverableProfile">
                                <span class="slider round"></span>
                            </label>
                        </div>

                        <div class="pref-item">
                            <div class="pref-text">
                                <span class="pref-title">Allow Messages from Partners</span>
                                <span class="pref-desc">Receive exclusive offers from NYC partners.</span>
                            </div>
                            <label class="switch">
                                <input type="checkbox" formControlName="AllowMessagesFromNycPartners">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>

                </div>

                <button type="submit" class="btn-submit" [disabled]="isLoading">
                    <span *ngIf="!isLoading">Create Visitor Account</span>
                    <span *ngIf="isLoading"><i class="spinner-border spinner-border-sm"></i> Processing...</span>
                </button>

            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <app-auth-success-modal [visible]="showModal" [title]="modalTitle" [message]="modalMessage" buttonText="Login Now"
        (closed)="onModalClose()">
    </app-auth-success-modal>

</div>