<div class="requests-container">
  <div class="header">
    <div class="title-section">
      <h1>RSS Feed Requests</h1>
      <p>Manage and review user-submitted RSS sources</p>
    </div>

    <div class="filters">
      <select [(ngModel)]="statusFilter" (change)="loadRequests()" class="status-select">
        <option [ngValue]="undefined">All Statuses</option>
        <option [ngValue]="0">Pending</option>
        <option [ngValue]="1">Approved</option>
        <option [ngValue]="2">Rejected</option>
      </select>
    </div>
  </div>

  <div class="content-card">
    <div *ngIf="isLoading" class="loader-overlay">
      <div class="spinner"></div>
    </div>

    <div *ngIf="errorMessage" class="error-banner">
      {{ errorMessage }}
    </div>

    <div class="table-wrapper">
      <table *ngIf="requests.length > 0; else emptyState">
        <thead>
          <tr>
            <th>Name / Source</th>
            <th>Category</th>
            <th>Requester</th>
            <th>Submitted</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let req of requests">
            <td>
              <div class="source-info">
                <img [src]="req.imageUrl || 'assets/images/rss-placeholder.png'" alt="" class="source-icon">
                <div class="details">
                  <span class="name">{{ req.name }}</span>
                  <a [href]="req.url" target="_blank" class="url">{{ req.url }}</a>
                </div>
              </div>
            </td>
            <td>
              <span class="category-badge">{{ getCategoryLabel(req.category) }}</span>
            </td>
            <td>
              <div class="requester">
                <span class="uname">{{ req.requesterName }}</span>
                <span class="uid">ID: {{ req.requesterId }}</span>
              </div>
            </td>
            <td>{{ req.createdAt | date:'short' }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(req.status)">
                {{ getStatusLabel(req.status) }}
              </span>
            </td>
            <td>
              <div class="actions" *ngIf="req.status === 0">
                <button (click)="openActionModal(req, 1)" class="btn-approve" title="Approve">
                  <i class="fas fa-check"></i>
                </button>
                <button (click)="openActionModal(req, 2)" class="btn-reject" title="Reject">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <div class="admin-note-preview" *ngIf="req.status !== 0 && req.adminNote">
                <i class="fas fa-comment-dots" [title]="req.adminNote"></i>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination" *ngIf="totalPages > 1">
      <button [disabled]="page === 1" (click)="onPageChange(page - 1)">Previous</button>
      <span>Page {{ page }} of {{ totalPages }}</span>
      <button [disabled]="page === totalPages" (click)="onPageChange(page + 1)">Next</button>
    </div>

    <ng-template #emptyState>
      <div class="empty-state">
        <i class="fas fa-rss-square"></i>
        <h3>No requests found</h3>
        <p>There are no user-submitted RSS sources matching your criteria.</p>
      </div>
    </ng-template>
  </div>
</div>

<!-- Action Modal -->
<div class="modal-overlay" *ngIf="showActionModal">
  <div class="modal-card">
    <div class="modal-header">
      <h2>{{ actionStatus === 1 ? 'Approve' : 'Reject' }} Request</h2>
      <button class="close-btn" (click)="showActionModal = false">&times;</button>
    </div>
    <div class="modal-body">
      <div class="req-preview">
        <strong>Source:</strong> {{ selectedRequest?.name }}<br>
        <strong>URL:</strong> {{ selectedRequest?.url }}
      </div>



      <div class="form-group">
        <label>Admin Note (Optional)</label>
        <textarea [(ngModel)]="adminNote" placeholder="Add a reason or note for this decision..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="showActionModal = false">Cancel</button>
      <button [class]="actionStatus === 1 ? 'btn-primary' : 'btn-danger'" (click)="submitAction()">
        Confirm {{ actionStatus === 1 ? 'Approval' : 'Rejection' }}
      </button>
    </div>
  </div>
</div>