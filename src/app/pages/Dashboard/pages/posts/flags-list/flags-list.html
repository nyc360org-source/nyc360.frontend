<div class="page-container">
  
  <div class="page-header">
    <div class="header-content">
      <h2>Reported Posts <span class="badge" *ngIf="!isLoading">{{ totalCount }}</span></h2>
      <p>Review flagged content.</p>
    </div>
    <button class="btn-refresh" (click)="loadFlags()">
      <i class="bi bi-arrow-clockwise"></i>
    </button>
  </div>

  <div class="flags-grid" *ngIf="isLoading">
    <div class="flag-card skeleton-card" *ngFor="let i of [1,2,3,4,5,6]">
      <div class="skeleton-header"></div>
      <div class="skeleton-body">
        <div class="line w-75"></div>
        <div class="line w-50"></div>
      </div>
      <div class="skeleton-footer"></div>
    </div>
  </div>

  <div *ngIf="!isLoading && flags.length === 0" class="state-container">
    <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
    <p>All clean! No reports.</p>
  </div>

  <div class="flags-grid" *ngIf="!isLoading && flags.length > 0">
    <div class="flag-card fade-in" *ngFor="let flag of flags; trackBy: trackByFlagId">
      
      <div class="flag-header">
        <span class="reason-badge" [ngClass]="'reason-' + flag.reason">
          <i class="bi bi-flag-fill"></i> {{ getReasonName(flag.reason) }}
        </span>
        <span class="reporter">By: <strong>{{ flag.username }}</strong></span>
      </div>

      <div class="flag-body">
        <h4>{{ flag.postTitle }}</h4>
        <p class="snippet">"{{ flag.postContentSnippet }}..."</p>
        <div class="report-details" *ngIf="flag.details">
          <small>Note:</small> <p>{{ flag.details }}</p>
        </div>
      </div>

      <div class="flag-footer">
        <span class="date">{{ flag.createdAt | date:'shortDate' }}</span>
        <button class="btn-review" (click)="openReviewModal(flag)">Action</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="isModalOpen">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Review Report</h3>
            <button class="btn-close" (click)="closeModal()"><i class="bi bi-x-lg"></i></button>
        </div>
        <div class="modal-body">
            <div class="preview-box">
                <label>Title:</label> <p>{{ selectedFlag?.postTitle }}</p>
                <label>Reason:</label> <span class="text-danger">{{ getReasonName(selectedFlag?.reason!) }}</span>
            </div>
            <div class="form-group">
                <label>Action:</label>
                <div class="radio-group">
                    <label class="radio-option action-taken">
                        <input type="radio" name="act" [value]="4" [(ngModel)]="reviewAction">
                        <div class="radio-content"><span>Delete Post</span></div>
                    </label>
                    <label class="radio-option rejected">
                        <input type="radio" name="act" [value]="3" [(ngModel)]="reviewAction">
                        <div class="radio-content"><span>Reject Report</span></div>
                    </label>
                </div>
            </div>
            <div class="form-group">
                <textarea [(ngModel)]="adminNote" rows="2" placeholder="Admin note..."></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" (click)="closeModal()">Cancel</button>
            <button class="btn-submit" (click)="submitReview()" [disabled]="isSubmitting">Confirm</button>
        </div>
    </div>
  </div>

</div>