<div class="modal-body" *ngIf="!isSuccess; else successTemplate">
    <div class="modal-header-premium">
        <h2>Contact the Agent</h2>
        <button class="close-x" (click)="cancel()"><i class="bi bi-x-lg"></i></button>
    </div>

    <!-- Agent Availability & Welcome Note -->
    <div class="agent-welcome-card" *ngIf="authorization">
        <div class="card-importance-tag">
            <i class="bi bi-exclamation-octagon-fill"></i>
            <span>ACTION REQUIRED: AGENT PREFERENCES</span>
        </div>

        <div class="agent-profile-mini">
            <div class="agent-avatar-ring">
                <i class="bi bi-person-badge-fill"></i>
            </div>
            <div class="agent-identity">
                <h4>{{ authorization.fullName }}</h4>
                <div class="id-row">
                    <span class="org-tag" *ngIf="authorization.organizationName">{{ authorization.organizationName
                        }}</span>
                    <span class="verified-badge"><i class="bi bi-patch-check-fill"></i> Verified</span>
                </div>
            </div>
        </div>

        <div class="welcome-message text-center">
            <h3>Optimize Your Request</h3>
            <p>To ensure a prioritized response, please select from the <strong>exclusive availability windows</strong>
                specified by the agent below:</p>

            <div class="availability-grid">
                <div class="avail-item" *ngIf="authorization.preferredContactDate">
                    <span class="a-label">Preferred Contact</span>
                    <span class="a-value">
                        <i class="bi bi-chat-dots-fill"></i>
                        {{ authorization.preferredContactDate | date:'MMM d' }} at {{ authorization.preferredContactTime
                        }}
                    </span>
                </div>
                <div class="avail-item" *ngIf="authorization.preferredVirtualTourDate">
                    <span class="a-label">Virtual Tours</span>
                    <span class="a-value">
                        <i class="bi bi-camera-video-fill"></i>
                        {{ authorization.preferredVirtualTourDate | date:'MMM d' }} at {{
                        authorization.preferredVirtualTourTime }}
                    </span>
                </div>
                <div class="avail-item" *ngIf="authorization.preferredInPersonTourDate">
                    <span class="a-label">In-Person Tours</span>
                    <span class="a-value">
                        <i class="bi bi-geo-alt-fill"></i>
                        {{ authorization.preferredInPersonTourDate | date:'MMM d' }} at {{
                        authorization.preferredInPersonTourTime }}
                    </span>
                </div>
            </div>
        </div>

        <div class="banner-footer-note">
            <i class="bi bi-lightning-charge-fill"></i>
            Tip: Requests aligned with these hours are usually answered within 1-2 hours.
        </div>
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="premium-form">
        <!-- Section 1: Your Information -->
        <div class="form-section-premium">
            <div class="section-badge">
                <span class="step-number">1</span>
                <h3>Your Information</h3>
            </div>

            <div class="form-group-premium">
                <label>Full Name</label>
                <input type="text" formControlName="Name" placeholder="Jane Doe"
                    [class.invalid]="isFieldInvalid('Name')">
            </div>

            <div class="form-row-premium">
                <div class="form-group-premium">
                    <label>Email Address</label>
                    <input type="email" formControlName="Email" placeholder="Jane@gmail.com"
                        [class.invalid]="isFieldInvalid('Email')">
                </div>
                <div class="form-group-premium">
                    <label>Phone Number</label>
                    <input type="tel" formControlName="PhoneNumber" placeholder="(555) 000 - 0000"
                        [class.invalid]="isFieldInvalid('PhoneNumber')">
                </div>
            </div>

            <div class="form-group-premium">
                <label>Preferred Contact Method *</label>
                <div class="custom-select-premium" (click)="toggleContactDropdown($event)">
                    <span class="selected-value">{{ selectedContactLabel }}</span>
                    <i class="bi bi-chevron-down"></i>
                    <div class="dropdown-menu-premium" *ngIf="showContactDropdown">
                        <div class="dropdown-item-premium" *ngFor="let type of contactTypes"
                            (click)="selectContactType(type, $event)">
                            {{ type.label }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-row-premium date-time-row">
                <div class="form-group-premium">
                    <label>Preferred Contact Date *</label>
                    <div class="date-input-wrapper">
                        <i class="bi bi-calendar3"></i>
                        <input type="date" formControlName="PrefContactDate" [min]="minContactDate"
                            [max]="maxContactDate">
                    </div>
                </div>
                <div class="form-group-premium">
                    <label>Preferred Contact Time *</label>
                    <div class="date-input-wrapper">
                        <i class="bi bi-clock"></i>
                        <input type="time" formControlName="PrefContactTime">
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: Interest Details -->
        <div class="form-section-premium">
            <div class="section-badge gold">
                <span class="step-number">2</span>
                <h3>Interest Details</h3>
            </div>

            <div class="form-group-premium">
                <label>Household Type</label>
                <div class="toggle-group-premium">
                    <button type="button" *ngFor="let type of householdTypes"
                        [class.active]="form.get('HouseholdType')?.value === type.value"
                        (click)="selectHouseholdType(type, $event)">
                        {{ type.label }}
                    </button>
                </div>
            </div>

            <div class="form-row-premium">
                <div class="form-group-premium">
                    <label>Select Move-in Date *</label>
                    <div class="date-input-wrapper">
                        <i class="bi bi-calendar-event"></i>
                        <input type="date" formControlName="MoveInDate" [min]="todayDate">
                    </div>
                </div>
                <div class="form-group-premium">
                    <label>Select Move-out Date</label>
                    <div class="date-input-wrapper">
                        <i class="bi bi-calendar-x"></i>
                        <input type="date" formControlName="MoveOutDate">
                    </div>
                </div>
            </div>

            <div class="form-row-premium date-time-row">
                <div class="form-group-premium">
                    <label>Schedule Virtual Tour</label>
                    <div class="date-input-wrapper">
                        <i class="bi bi-camera-video"></i>
                        <input type="date" formControlName="ScheduleVirtualDate" [min]="minVirtualDate"
                            [max]="maxVirtualDate">
                    </div>
                </div>
                <div class="form-group-premium">
                    <label>Time Window</label>
                    <div class="date-input-wrapper">
                        <i class="bi bi-clock-history"></i>
                        <input type="time" formControlName="VirtualTime">
                    </div>
                </div>
            </div>

            <div class="form-row-premium date-time-row">
                <div class="form-group-premium">
                    <label>Schedule In-Person Tour</label>
                    <div class="date-input-wrapper">
                        <i class="bi bi-geo-alt"></i>
                        <input type="date" formControlName="InPersonTourDate" [min]="minInPersonDate"
                            [max]="maxInPersonDate">
                    </div>
                </div>
                <div class="form-group-premium">
                    <label>Time Window</label>
                    <div class="date-input-wrapper">
                        <i class="bi bi-alarm"></i>
                        <input type="time" formControlName="InPersonTime">
                    </div>
                </div>
            </div>

            <div class="form-group-premium">
                <label>Personal Message *</label>
                <textarea formControlName="Message" rows="4"
                    placeholder="Hi, I'm interested in this property. I'd love to schedule a viewing ......."></textarea>
            </div>
        </div>

        <div class="form-footer-premium">
            <div class="response-time">
                <span class="label">AGENT RESPONSE TIME</span>
                <span class="value">Avg. 4 hours</span>
            </div>
            <button type="submit" class="btn-send-premium" [disabled]="isSubmitting">
                <span>Send Inquiry</span>
                <i class="bi bi-send-fill" *ngIf="!isSubmitting"></i>
                <span class="spinner-border spinner-border-sm" *ngIf="isSubmitting"></span>
            </button>
        </div>
    </form>
</div>

<ng-template #successTemplate>
    <div class="success-view-premium">
        <div class="success-icon">
            <i class="bi bi-check-circle-fill"></i>
        </div>
        <h2>Inquiry Sent!</h2>
        <p>The agent will get back to you within 4 hours. You can track your requests in your dashboard.</p>
        <button class="btn-send-premium" (click)="cancel()">Close</button>
    </div>
</ng-template>