<div class="modal-body" *ngIf="!isSuccess; else successTemplate">
    <div class="modal-header-premium">
        <h2>Contact the Agent</h2>
        <button class="close-x" (click)="cancel()"><i class="bi bi-x-lg"></i></button>
    </div>

    <!-- Agent Availability Tip -->
    <div class="agent-availability-banner" *ngIf="authorization">
        <div class="banner-icon">
            <i class="bi bi-info-circle-fill"></i>
        </div>
        <div class="banner-text">
            <strong>{{ authorization.fullName }}'s Availability</strong>
            <p *ngIf="authorization.organizationName" class="small text-muted mb-2">Representing: {{
                authorization.organizationName }}</p>
            <p>To ensure a faster response, the agent has specified their preferred availability:</p>
            <div class="availability-chips">
                <span class="a-chip" *ngIf="authorization.preferredContactDate">
                    <i class="bi bi-chat-text"></i> Contact: {{ authorization.preferredContactDate | date:'mediumDate'
                    }} at {{ authorization.preferredContactTime }}
                </span>
                <span class="a-chip" *ngIf="authorization.preferredVirtualTourDate">
                    <i class="bi bi-camera-video"></i> Virtual: {{ authorization.preferredVirtualTourDate |
                    date:'mediumDate' }} at {{ authorization.preferredVirtualTourTime }}
                </span>
                <span class="a-chip" *ngIf="authorization.preferredInPersonTourDate">
                    <i class="bi bi-geo-alt"></i> In-Person: {{ authorization.preferredInPersonTourDate |
                    date:'mediumDate' }} at {{ authorization.preferredInPersonTourTime }}
                </span>
            </div>
            <p class="small mt-2 mb-0 opacity-75">Please try to align your request with these times if possible.</p>
        </div>
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="premium-form">
        <!-- Section 1: Your Information -->
        <div class="form-section-premium">
            <div class="section-badge">
                <span class="step-number">1</span>
                <h3>Your Information</h3>
            </div>

            <div class="form-group-premium">
                <label>Full Name</label>
                <input type="text" formControlName="Name" placeholder="Jane Doe"
                    [class.invalid]="isFieldInvalid('Name')">
            </div>

            <div class="form-row-premium">
                <div class="form-group-premium">
                    <label>Email Address</label>
                    <input type="email" formControlName="Email" placeholder="Jane@gmail.com"
                        [class.invalid]="isFieldInvalid('Email')">
                </div>
                <div class="form-group-premium">
                    <label>Phone Number</label>
                    <input type="tel" formControlName="PhoneNumber" placeholder="(555) 000 - 0000"
                        [class.invalid]="isFieldInvalid('PhoneNumber')">
                </div>
            </div>

            <div class="form-group-premium">
                <label>Preferred Contact Method *</label>
                <div class="custom-select-premium" (click)="toggleContactDropdown($event)">
                    <span class="selected-value">{{ selectedContactLabel }}</span>
                    <i class="bi bi-chevron-down"></i>
                    <div class="dropdown-menu-premium" *ngIf="showContactDropdown">
                        <div class="dropdown-item-premium" *ngFor="let type of contactTypes"
                            (click)="selectContactType(type, $event)">
                            {{ type.label }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-row-premium">
                <div class="form-group-premium">
                    <label>Preferred Contact Date *</label>
                    <div class="date-input-wrapper">
                        <input type="date" formControlName="PrefContactDate">
                    </div>
                </div>
                <div class="form-group-premium">
                    <label>Preferred Contact Time *</label>
                    <div class="date-input-wrapper">
                        <input type="time" formControlName="PrefContactTime">
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: Interest Details -->
        <div class="form-section-premium">
            <div class="section-badge gold">
                <span class="step-number">2</span>
                <h3>Interest Details</h3>
            </div>

            <div class="form-group-premium">
                <label>Household Type</label>
                <div class="toggle-group-premium">
                    <button type="button" *ngFor="let type of householdTypes"
                        [class.active]="form.get('HouseholdType')?.value === type.value"
                        (click)="selectHouseholdType(type, $event)">
                        {{ type.label }}
                    </button>
                </div>
            </div>

            <div class="form-row-premium">
                <div class="form-group-premium">
                    <label>Select Move-in Date *</label>
                    <div class="date-input-wrapper">
                        <input type="date" formControlName="MoveInDate">
                    </div>
                </div>
                <div class="form-group-premium">
                    <label>Select Move-out Date</label>
                    <div class="date-input-wrapper">
                        <input type="date" formControlName="MoveOutDate">
                    </div>
                </div>
            </div>

            <div class="form-row-premium">
                <div class="form-group-premium">
                    <label>Schedule Virtual Tour</label>
                    <div class="date-input-wrapper">
                        <input type="date" formControlName="ScheduleVirtualDate">
                    </div>
                </div>
                <div class="form-group-premium">
                    <label>Time Window</label>
                    <div class="date-input-wrapper">
                        <input type="time" formControlName="VirtualTime">
                    </div>
                </div>
            </div>

            <div class="form-row-premium">
                <div class="form-group-premium">
                    <label>Schedule In-Person Tour</label>
                    <div class="date-input-wrapper">
                        <input type="date" formControlName="InPersonTourDate">
                    </div>
                </div>
                <div class="form-group-premium">
                    <label>Time Window</label>
                    <div class="date-input-wrapper">
                        <input type="time" formControlName="InPersonTime">
                    </div>
                </div>
            </div>

            <div class="form-group-premium">
                <label>Personal Message *</label>
                <textarea formControlName="Message" rows="4"
                    placeholder="Hi, I'm interested in this property. I'd love to schedule a viewing ......."></textarea>
            </div>
        </div>

        <div class="form-footer-premium">
            <div class="response-time">
                <span class="label">AGENT RESPONSE TIME</span>
                <span class="value">Avg. 4 hours</span>
            </div>
            <button type="submit" class="btn-send-premium" [disabled]="isSubmitting">
                <span>Send Inquiry</span>
                <i class="bi bi-send-fill" *ngIf="!isSubmitting"></i>
                <span class="spinner-border spinner-border-sm" *ngIf="isSubmitting"></span>
            </button>
        </div>
    </form>
</div>

<ng-template #successTemplate>
    <div class="success-view-premium">
        <div class="success-icon">
            <i class="bi bi-check-circle-fill"></i>
        </div>
        <h2>Inquiry Sent!</h2>
        <p>The agent will get back to you within 4 hours. You can track your requests in your dashboard.</p>
        <button class="btn-send-premium" (click)="cancel()">Close</button>
    </div>
</ng-template>