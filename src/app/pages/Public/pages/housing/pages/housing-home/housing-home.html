<div class="housing-page">
    <!-- 1. Elegant Header -->
    <header class="housing-header">
        <span class="welcome-text">Welcome at NYC360</span>
        <h1 class="page-title">Housing</h1>
        <p class="page-subtitle">Where New Yorkers can share ideas, discussions, and local conversations</p>
    </header>

    <!-- 2. Hero Component -->
    <div class="hero-container" *ngIf="heroPost">
        <div class="hero-premium-card">
            <div class="hero-visual">
                <img [src]="imageService.resolveImageUrl(heroPost.attachments?.[0]?.url, 'housing')"
                    [appImgFallback]="'post'" alt="Hero Featured">
            </div>
            <div class="hero-info">
                <div class="meta-tags">
                    <span class="status-badge" *ngIf="heroPost.metadata?.IsRenting">For Rent</span>
                    <span class="status-badge" *ngIf="!heroPost.metadata?.IsRenting">For Sale</span>
                    <span class="time">{{ heroPost.createdAt | date:'shortTime' }}</span>
                </div>
                <h2 class="hero-title">{{ heroPost.title }}</h2>
                <p class="hero-desc">
                    {{ heroPost.displayDescription | slice:0:180 }}
                </p>

                <div class="hero-meta mb-4" *ngIf="heroPost.metadata">
                    <span class="price-value" style="font-size: 1.8rem; color: #BC9D5F; font-weight: 800;">
                        {{ formatPrice(heroPost.metadata.Price || 0) }}{{ heroPost.metadata.IsRenting ? '/mo' : '' }}
                    </span>
                </div>

                <button class="btn-hero" [routerLink]="['/public/housing/details', heroPost.id]">View details</button>
            </div>
        </div>
    </div>

    <!-- 3. Navigation & Actions Bar -->
    <div class="nav-filters-bar">
        <div class="action-row">
            <div class="tabs-group">
                <button class="tab-btn" [class.active]="selectedTab === 'explore'"
                    [routerLink]="['/public/housing/feed']">
                    <i class="bi bi-compass-fill"></i> Explore Homes
                </button>
                <button class="tab-btn" [class.active]="selectedTab === 'inquiries'"
                    (click)="selectedTab = 'inquiries'">
                    <i class="bi bi-chat-left-text"></i> My Inquiries
                </button>
            </div>

            <div class="quick-actions">
                <button class="btn-action gold">
                    <i class="bi bi-plus-lg"></i> Post Listing
                </button>
                <button class="btn-action">
                    <i class="bi bi-pencil-square"></i> Create Post
                </button>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-row">
            <div class="filter-dropdown">Location <i class="bi bi-chevron-down"></i></div>
            <div class="filter-dropdown">Property Type <i class="bi bi-chevron-down"></i></div>
            <div class="filter-dropdown">Rooms/Baths <i class="bi bi-chevron-down"></i></div>
            <div class="filter-dropdown">Price <i class="bi bi-chevron-down"></i></div>
            <a class="clear-btn">clear now</a>
        </div>
    </div>

    <main class="content-body" *ngIf="!isLoading">

        <!-- 4. Homes For Sale Section -->
        <section class="section-wrapper" *ngIf="homesForSale.length > 0">
            <div class="section-head">
                <h3 class="section-title">Homes For Sale</h3>
                <a [routerLink]="['/public/housing/feed']" [queryParams]="{type: 'sale'}" class="view-all">View All</a>
            </div>
            <div class="housing-grid">
                <div class="premium-card" *ngFor="let item of homesForSale"
                    [routerLink]="['/public/housing/details', item.id]">
                    <div class="card-thumb">
                        <img [src]="imageService.resolveImageUrl(item.imageUrl, 'housing')" [appImgFallback]="'post'">
                        <span class="tag-price-badge">For Sale</span>
                    </div>
                    <div class="card-content">
                        <span class="loc-label">{{ item.location?.neighborhood || 'NYC Area' }}</span>
                        <h4 class="prop-title">{{ item.title }}</h4>
                        <div class="prop-stats">
                            <span><i class="bi bi-rulers"></i> {{ item.size }} SQFT</span>
                            <span><i class="bi bi-door-open"></i> {{ item.numberOfRooms }} ROOMS</span>
                            <span><i class="bi bi-droplet"></i> {{ item.numberOfBathrooms }} BATH</span>
                        </div>
                        <p class="price-value">{{ formatPrice(item.startingPrice) }}</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. Homes For Rent Section -->
        <section class="section-wrapper" *ngIf="homesForRent.length > 0">
            <div class="section-head">
                <h3 class="section-title">Homes For Rent</h3>
                <a [routerLink]="['/public/housing/feed']" [queryParams]="{type: 'rent'}" class="view-all">View All</a>
            </div>
            <div class="housing-grid four-cols">
                <div class="premium-card" *ngFor="let item of (homesForRent | slice:0:4)"
                    [routerLink]="['/public/housing/details', item.id]">
                    <div class="card-thumb">
                        <img [src]="imageService.resolveImageUrl(item.imageUrl, 'housing')" [appImgFallback]="'post'">
                        <span class="tag-price-badge">For Rent</span>
                    </div>
                    <div class="card-content">
                        <span class="loc-label">{{ item.location?.neighborhood || 'Upper West Side' }}</span>
                        <h4 class="prop-title">{{ item.title }}</h4>
                        <p class="price-value">{{ formatPrice(item.startingPrice) }}/mo</p>
                        <div class="prop-stats mt-2" style="background: none; padding: 0;">
                            <span><i class="bi bi-door-open"></i> {{ item.numberOfRooms }} Bed</span>
                            <span><i class="bi bi-droplet"></i> {{ item.numberOfBathrooms }} Bath</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. Official Posts (RSS) Section -->
        <section class="section-wrapper" *ngIf="rssPosts.length > 0">
            <div class="section-head">
                <h3 class="section-title">NYC Housing Programs Official Posts</h3>
                <a href="#" class="view-all">View All</a>
            </div>
            <div class="housing-grid">
                <div class="premium-card" *ngFor="let post of (rssPosts | slice:0:3)"
                    [routerLink]="['/public/housing/details', post.id]">
                    <div class="card-thumb" style="height: 220px;">
                        <img [src]="post.attachments?.[0]?.url" [appImgFallback]="'post'">
                    </div>
                    <div class="card-content">
                        <h4 class="prop-title">{{ post.title }}</h4>
                        <div class="prop-stats">
                            <span><i class="bi bi-building"></i> Programs</span>
                        </div>
                        <p class="price-value" style="font-size: 0.95rem; color: #999;">Read Official Guidelines</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 7. Discussion Spotlight Section -->
        <section class="discussion-section" *ngIf="discussionPosts.length > 0">
            <div class="section-wrapper">
                <div class="discussion-spotlight" *ngFor="let post of (discussionPosts | slice:0:1)">
                    <div class="disc-meta">
                        <span class="user">{{ post.author?.fullName || post.CreatorName }}</span>
                        <span class="dot"></span>
                        <span>Housing</span>
                        <span class="dot"></span>
                        <span>{{ post.createdAt | date }}</span>
                    </div>
                    <h3 class="disc-title">{{ post.title }}</h3>
                    <p class="disc-body">"{{ post.displayDescription || post.content | slice:0:250 }}..."</p>
                    <div class="disc-footer">
                        <div class="replies"><i class="bi bi-chat-left-text"></i> {{ post.stats?.comments }} replies
                        </div>
                        <button class="btn-join-disc" [routerLink]="['/public/housing/details', post.id]">Read
                            More</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 8. All Posts Grid -->
        <section class="section-wrapper">
            <div class="section-head">
                <h3 class="section-title">All Posts</h3>
                <a href="#" class="view-all">View All</a>
            </div>
            <div class="housing-grid four-cols">
                <!-- Fallback to Renting if 'all' is empty for demonstration, or use allPosts if populated -->
                <div class="premium-card"
                    *ngFor="let item of (allPosts.length > 0 ? allPosts : (homesForRent | slice:0:4))"
                    [routerLink]="['/public/housing/details', item.id]">
                    <div class="card-thumb">
                        <img [src]="imageService.resolveImageUrl(item.imageUrl, 'housing')" [appImgFallback]="'post'">
                    </div>
                    <div class="card-content">
                        <span class="loc-label">{{ item.location?.neighborhood || 'Manhattan' }}</span>
                        <h4 class="prop-title">{{ item.title }}</h4>
                        <p class="price-value">{{ formatPrice(item.startingPrice) }}</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Loading State -->
    <div class="housing-loader" *ngIf="isLoading">
        <div class="spinner"></div>
        <p>Curating your housing experience...</p>
    </div>
</div>