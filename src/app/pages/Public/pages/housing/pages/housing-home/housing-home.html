<div class="housing-page" *ngIf="!isLoading">
    <!-- Header -->
    <header class="housing-header">
        <p class="welcome-text">Welcome at NYC360</p>
        <h1 class="page-title">Housing</h1>
        <p class="sub-title">Where New Yorkers can share ideas, discussions, and local conversations</p>
    </header>

    <!-- Hero Section -->
    <section class="hero-section" *ngIf="heroPost">
        <div class="hero-card">
            <div class="hero-image-wrapper">
                <img [src]="imageService.resolveImageUrl(heroPost.imageUrl || (heroPost.attachments?.[0]?.url))"
                    alt="Hero Home" appImgFallback="post">
            </div>
            <div class="hero-content">
                <div class="tags">
                    <span class="tag-pill">New Listing</span>
                    <span class="tag-simple">{{ heroPost.location?.borough || 'NYC' }}</span>
                </div>
                <h2>{{ heroPost.title }}</h2>
                <p class="hero-desc">{{ heroPost.content | slice:0:150 }}...</p>
                <div class="hero-actions">
                    <a [routerLink]="['/public/posts/details', heroPost.id]" class="btn-gold-solid">View details</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Action Bar -->
    <div class="action-bar-container">
        <div class="main-actions">
            <div class="left-group">
                <button class="btn-tab active"><i class="bi bi-check-circle-fill"></i> Explore Homes</button>
                <button class="btn-tab" routerLink="/public/housing/requests"><i
                        class="bi bi-layout-text-window-reverse"></i> My Inquiries</button>
            </div>
            <div class="right-group">
                <a routerLink="/public/housing/create" class="btn-outline-gold"><i class="bi bi-plus-lg"></i> Post
                    Listing</a>
                <a routerLink="/public/posts/create" class="btn-outline-gold"><i class="bi bi-pencil-square"></i> Create
                    Post</a>
            </div>
        </div>


    </div>

    <!-- Homes For Sale -->
    <section class="listing-section" *ngIf="homesForSale.length > 0">
        <div class="section-header">
            <h3>Homes For Sale</h3>
        </div>
        <div class="grid-cards">
            <div class="property-card" *ngFor="let item of homesForSale"
                [routerLink]="['/public/posts/details', item.id]">
                <div class="card-img">
                    <img [src]="imageService.resolveImageUrl(item.attachments?.[0]?.url || item.imageUrl)"
                        alt="Property" appImgFallback="post">
                </div>
                <div class="card-body">
                    <h4 class="prop-title">{{ item.title }}</h4>

                    <ng-container *ngIf="getPostMetadata(item.content) as meta">
                        <div class="prop-stats">
                            <span><i class="bi bi-rulers"></i> {{ meta.SizeSqFt || 0 }} sqft</span>
                            <span><i class="bi bi-door-closed"></i> {{ meta.Rooms || 0 }} rooms</span>
                            <span><i class="bi bi-droplet"></i> {{ meta.Bathrooms || 0 }} baths</span>
                        </div>
                        <div class="prop-price">{{ formatPrice(meta.Price || 0) }}</div>
                    </ng-container>
                    <ng-container *ngIf="!getPostMetadata(item.content)">
                        <div class="prop-price" style="font-size: 0.9rem; color: #777;">Contact for Price</div>
                    </ng-container>
                </div>
            </div>
        </div>
    </section>

    <!-- Homes For Rent -->
    <section class="listing-section" *ngIf="homesForRent.length > 0">
        <div class="section-header">
            <h3>Homes For Rent</h3>
        </div>
        <div class="grid-cards">
            <div class="property-card" *ngFor="let item of homesForRent"
                [routerLink]="['/public/posts/details', item.id]">
                <div class="card-img">
                    <img [src]="imageService.resolveImageUrl(item.attachments?.[0]?.url || item.imageUrl)"
                        alt="Property" appImgFallback="post">
                </div>
                <div class="card-body">
                    <div class="loc-badge-row">
                        <span class="neighborhood">{{ item.location?.neighborhood || 'NYC' }}</span>
                        <span class="status-badge">FOR RENT</span>
                    </div>

                    <ng-container *ngIf="getPostMetadata(item.content) as meta">
                        <div class="prop-price-large">{{ formatPrice(meta.Price || 0) }}/mo</div>
                        <div class="prop-stats compact">
                            <span><i class="bi bi-door-closed"></i> {{ meta.Rooms }} Bed</span>
                            <span><i class="bi bi-droplet"></i> {{ meta.Bathrooms }} Bath</span>
                            <span class="details-link">Details</span>
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>
    </section>

    <!-- NYC Housing Programs (RSS) -->
    <section class="listing-section" *ngIf="rssPosts.length > 0">
        <div class="section-header">
            <h3>NYC Housing Programs Official Posts</h3>
        </div>
        <div class="grid-cards">
            <div class="property-card" *ngFor="let item of rssPosts" [routerLink]="['/public/posts/details', item.id]">
                <div class="card-img">
                    <img [src]="imageService.resolveImageUrl(item.attachments?.[0]?.url || item.imageUrl)" alt="News"
                        appImgFallback="post">
                </div>
                <div class="card-body">
                    <h4 class="prop-title text-truncate">{{ item.title }}</h4>
                    <div class="prop-stats">
                        <span style="font-size: 0.8rem; color: #777;"><i class="bi bi-clock"></i> {{ item.createdAt |
                            date:'mediumDate' }}</span>
                    </div>
                    <div class="prop-price" style="font-size: 1rem; color: #B59B62;">Read Article</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Discussions -->
    <section class="discussion-section" *ngIf="discussionPosts.length > 0">
        <div class="discussions-container">
            <div class="discussion-item" *ngFor="let item of discussionPosts">
                <div class="disc-meta">
                    <span class="author-name">{{ item.author?.username || 'User' }}</span> •
                    <span class="cat-link">HousingDiscussion</span> •
                    <span class="date">{{ item.createdAt | date:'shortDate' }}</span>
                </div>
                <h4 class="disc-title" [routerLink]="['/public/posts/details', item.id]">{{ item.title }}</h4>
                <p class="disc-excerpt">{{ item.content | slice:0:180 }}...</p>
                <div class="disc-footer">
                  
                </div>
            </div>
        </div>
    </section>
</div>
<div *ngIf="isLoading" style="text-align: center; padding: 50px;">
    <div class="spinner-border text-gold" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>