<div class="housing-page">
    <!-- 1. Elegant Header -->
    <header class="housing-header">
        <span class="welcome-text">Welcome at NYC360</span>
        <h1 class="page-title">Housing</h1>
        <p class="page-subtitle">Where New Yorkers can share ideas, discussions, and local conversations</p>

        <div class="header-nav-buttons">
            <a routerLink="/public/housing/feed" class="nav-btn" routerLinkActive="active">
                <i class="bi bi-compass me-2"></i> Explore
            </a>
            <a routerLink="/public/housing/my-requests" class="nav-btn" routerLinkActive="active">
                <i class="bi bi-chat-left-text me-2"></i> My Inquiries
            </a>
            <a routerLink="/public/housing/agent/dashboard" class="nav-btn" routerLinkActive="active">
                <i class="bi bi-speedometer2 me-2"></i> Contributer Dashboard
            </a>
            <!-- Dropdown for Contributor Activity -->
            <div class="nav-dropdown-wrapper">
                <button class="nav-btn dropdown-toggle-btn">
                    <i class="bi bi-activity me-2"></i> Contributer Activity <i
                        class="bi bi-chevron-down ms-2 small-arrow"></i>
                </button>
                <div class="dropdown-menu-custom">
                    <a routerLink="/public/housing/create/renting" class="dropdown-item-custom">
                        <i class="bi bi-key"></i> Renting (Room/Apartment)
                    </a>
                    <a routerLink="/public/housing/create/sale" class="dropdown-item-custom">
                        <i class="bi bi-house-door"></i> Selling (Unit/Building)
                    </a>
                </div>
            </div>
            <a routerLink="/public/posts/create" class="nav-btn" routerLinkActive="active">
                <i class="bi bi-patch-question me-2"></i> Ask a Question
            </a>
        </div>
    </header>

    <!-- 2. Hero Component -->
    <div class="hero-container" *ngIf="heroPost">

        <div class="hero-premium-card">
            <div class="hero-visual">
                <ng-container
                    *ngIf="imageService.resolveImageUrl(heroPost.attachments?.[0]?.url, 'housing') as heroUrl">
                    <video *ngIf="isVideo(heroUrl)" [src]="heroUrl" [muted]="true" [loop]="true" autoplay playsinline
                        class="w-100 h-100 object-fit-cover"></video>
                    <img *ngIf="!isVideo(heroUrl)" [src]="heroUrl" [appImgFallback]="'housing'" alt="Hero Featured">
                </ng-container>
            </div>
            <div class="hero-info">
                <div class="meta-tags">
                    <span class="status-badge" *ngIf="heroPost.metadata?.IsRenting">For Rent</span>
                    <span class="status-badge" *ngIf="!heroPost.metadata?.IsRenting">For Sale</span>
                    <span class="time">{{ heroPost.createdAt | date:'shortTime' }}</span>
                </div>
                <h2 class="hero-title">{{ heroPost.title }}</h2>
                <p class="hero-desc">
                    {{ heroPost.displayDescription | slice:0:180 }}
                </p>

                <div class="hero-meta mb-4" *ngIf="heroPost.metadata">
                    <span class="price-value" style="font-size: 1.8rem; color: #BC9D5F; font-weight: 800;">
                        {{ formatPrice(heroPost.metadata.Price || 0) }}{{ heroPost.metadata.IsRenting ? '/mo' : '' }}
                    </span>
                </div>

                <button class="btn-hero" [routerLink]="['/public/posts/details', heroPost.id]">View details</button>
            </div>
        </div>
    </div>

    <!-- 3. Navigation & Actions Bar -->


    <main class="content-body" *ngIf="!isLoading">

        <!-- 4. Homes For Sale Section -->
        <section class="section-wrapper" *ngIf="homesForSale.length > 0">
            <div class="section-head">
                <h3 class="section-title">Homes For Sale</h3>
                <a [routerLink]="['/public/housing/feed']" [queryParams]="{type: 'sale'}" class="view-all">View All</a>
            </div>
            <div class="housing-grid">
                <div class="premium-card" *ngFor="let item of homesForSale"
                    [routerLink]="['/public/housing/details', item.id]">

                    <ng-container
                        *ngIf="imageService.resolveImageUrl(item.imageUrl || item.attachments?.[0]?.url, 'housing') as thumbUrl">
                        <div class="card-thumb" *ngIf="thumbUrl && thumbUrl !== imageService.DEFAULT_HOUSING">
                            <video *ngIf="isVideo(thumbUrl)" [src]="thumbUrl" muted loop onmouseover="this.play()"
                                onmouseout="this.pause()" class="w-100 h-100 object-fit-cover"></video>
                            <img *ngIf="!isVideo(thumbUrl)" [src]="thumbUrl">
                            <div *ngIf="isVideo(thumbUrl)"
                                class="position-absolute top-50 start-50 translate-middle text-white"
                                style="pointer-events:none;"><i class="bi bi-play-circle-fill fs-3 shadow-lg"></i>
                            </div>
                            <span class="tag-price-badge">For Sale</span>
                        </div>
                    </ng-container>

                    <div class="card-content">
                        <span class="loc-label">{{ item.location?.neighborhood || 'NYC Area' }}</span>
                        <h4 class="prop-title">{{ item.title }}</h4>
                        <div class="prop-stats">
                            <span><i class="bi bi-rulers"></i> {{ item.size }} SQFT</span>
                            <span><i class="bi bi-door-open"></i> {{ item.numberOfRooms }} ROOMS</span>
                            <span><i class="bi bi-droplet"></i> {{ item.numberOfBathrooms }} BATH</span>
                        </div>
                        <p class="price-value">{{ formatPrice(item.startingPrice) }}</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. Homes For Rent Section -->
        <section class="section-wrapper" *ngIf="homesForRent.length > 0">
            <div class="section-head">
                <h3 class="section-title">Homes For Rent</h3>
                <a [routerLink]="['/public/housing/feed']" [queryParams]="{type: 'rent'}" class="view-all">View All</a>
            </div>
            <div class="housing-grid four-cols">
                <div class="premium-card" *ngFor="let item of (homesForRent | slice:0:4)"
                    [routerLink]="['/public/housing/details', item.id]">

                    <ng-container
                        *ngIf="imageService.resolveImageUrl(item.imageUrl || item.attachments?.[0]?.url, 'housing') as thumbUrl">
                        <div class="card-thumb" *ngIf="thumbUrl && thumbUrl !== imageService.DEFAULT_HOUSING">
                            <video *ngIf="isVideo(thumbUrl)" [src]="thumbUrl" muted loop onmouseover="this.play()"
                                onmouseout="this.pause()" class="w-100 h-100 object-fit-cover"></video>
                            <img *ngIf="!isVideo(thumbUrl)" [src]="thumbUrl">
                            <div *ngIf="isVideo(thumbUrl)"
                                class="position-absolute top-50 start-50 translate-middle text-white"
                                style="pointer-events:none;"><i class="bi bi-play-circle-fill fs-3 shadow-lg"></i>
                            </div>
                            <span class="tag-price-badge">For Rent</span>
                        </div>
                    </ng-container>

                    <div class="card-content">
                        <span class="loc-label">{{ item.location?.neighborhood || 'Upper West Side' }}</span>
                        <h4 class="prop-title">{{ item.title }}</h4>
                        <p class="price-value">{{ formatPrice(item.startingPrice) }}/mo</p>
                        <div class="prop-stats mt-2" style="background: none; padding: 0;">
                            <span><i class="bi bi-door-open"></i> {{ item.numberOfRooms }} Bed</span>
                            <span><i class="bi bi-droplet"></i> {{ item.numberOfBathrooms }} Bath</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5.1 More Opportunities (Text Only) -->
        <section class="section-wrapper" *ngIf="textOnlyListings.length > 0">
            <div class="section-head">
                <h3 class="section-title">More Housing Opportunities</h3>
            </div>
            <div class="text-only-grid">
                <div class="text-listing-card" *ngFor="let item of textOnlyListings"
                    [routerLink]="['/public/housing/details', item.id]">
                    <div class="card-header-row">
                        <span class="type-badge-mini"
                            [class.rent]="item.startingPrice < 50000 || item.title?.toLowerCase()?.includes('rent')">
                            {{ (item.startingPrice < 50000 || item.title?.toLowerCase()?.includes('rent')) ? 'For Rent'
                                : 'For Sale' }} </span>
                                <span class="price-text">{{ formatPrice(item.startingPrice) }}{{ (item.startingPrice <
                                        50000 || item.title?.toLowerCase()?.includes('rent')) ? '/mo' : '' }}</span>
                    </div>
                    <h4 class="text-card-title">{{ item.title }}</h4>
                    <div class="text-card-meta">
                        <span><i class="bi bi-geo-alt"></i> {{ item.location?.neighborhood || 'NYC' }}</span>
                        <span class="separator">•</span>
                        <span>{{ item.numberOfRooms }} Beds</span>
                        <span class="separator">•</span>
                        <span>{{ item.numberOfBathrooms }} Baths</span>
                    </div>
                    <div class="hover-indicator">View Details <i class="bi bi-arrow-right"></i></div>
                </div>
            </div>
        </section>

        <!-- 6. Official Posts (RSS) Section -->
        <section class="section-wrapper" *ngIf="rssPosts.length > 0">
            <div class="section-head">
                <h3 class="section-title">NYC Housing Programs Official Posts</h3>
            </div>
            <div class="housing-grid">
                <div class="premium-card" *ngFor="let post of (rssPosts | slice:0:3)"
                    [routerLink]="['/public/posts/details', post.id]">

                    <ng-container *ngIf="imageService.resolveImageUrl(post.attachments?.[0]?.url, 'post') as thumbUrl">
                        <div class="card-thumb" style="height: 220px;"
                            *ngIf="thumbUrl && thumbUrl !== imageService.DEFAULT_HOUSING && thumbUrl !== imageService.DEFAULT_POST">
                            <video *ngIf="isVideo(thumbUrl)" [src]="thumbUrl" muted loop onmouseover="this.play()"
                                onmouseout="this.pause()" class="w-100 h-100 object-fit-cover"></video>
                            <img *ngIf="!isVideo(thumbUrl)" [src]="thumbUrl">
                            <div *ngIf="isVideo(thumbUrl)"
                                class="position-absolute top-50 start-50 translate-middle text-white"
                                style="pointer-events:none;"><i class="bi bi-play-circle-fill fs-3 shadow-lg"></i>
                            </div>
                        </div>
                    </ng-container>

                    <div class="card-content">
                        <h4 class="prop-title">{{ post.title }}</h4>
                        <div class="prop-stats">
                            <span><i class="bi bi-building"></i> Programs</span>
                        </div>
                        <p class="price-value" style="font-size: 0.95rem; color: #999;">Read Official Guidelines</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 7. Discussion Spotlight Section -->
        <section class="discussion-section" *ngIf="discussionPosts.length > 0">
            <div class="section-wrapper">
                <div class="discussion-spotlight" *ngFor="let post of (discussionPosts | slice:0:1)">
                    <div class="disc-meta">
                        <span class="user">{{ post.author?.fullName || post.CreatorName }}</span>
                        <span class="dot"></span>
                        <span>Housing</span>
                        <span class="dot"></span>
                        <span>{{ post.createdAt | date }}</span>
                    </div>
                    <h3 class="disc-title">{{ post.title }}</h3>
                    <p class="disc-body">"{{ post.displayDescription || post.content | slice:0:250 }}..."</p>
                    <div class="disc-footer">
                        <div class="replies"><i class="bi bi-chat-left-text"></i> {{ post.stats?.comments }} replies
                        </div>
                        <button class="btn-join-disc" [routerLink]="['/public/posts/details', post.id]">Read
                            More</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 8. All Posts Grid -->
        <section class="section-wrapper">
            <div class="section-head">
                <h3 class="section-title">All Posts</h3>
            </div>
            <div class="housing-grid four-cols">
                <!-- Fallback to Renting if 'all' is empty for demonstration, or use allPosts if populated -->
                <div class="premium-card"
                    *ngFor="let item of (allPosts.length > 0 ? allPosts : (homesForRent | slice:0:4))"
                    [routerLink]="['/public/housing/details', item.id]">

                    <ng-container
                        *ngIf="imageService.resolveImageUrl(item.imageUrl || item.attachments?.[0]?.url, 'housing') as thumbUrl">
                        <div class="card-thumb" *ngIf="thumbUrl && thumbUrl !== imageService.DEFAULT_HOUSING">
                            <video *ngIf="isVideo(thumbUrl)" [src]="thumbUrl" muted loop onmouseover="this.play()"
                                onmouseout="this.pause()" class="w-100 h-100 object-fit-cover"></video>
                            <img *ngIf="!isVideo(thumbUrl)" [src]="thumbUrl">
                            <div *ngIf="isVideo(thumbUrl)"
                                class="position-absolute top-50 start-50 translate-middle text-white"
                                style="pointer-events:none;"><i class="bi bi-play-circle-fill fs-3 shadow-lg"></i>
                            </div>
                        </div>
                    </ng-container>
                    <div class="card-content">
                        <span class="loc-label">{{ item.location?.neighborhood || 'Manhattan' }}</span>
                        <h4 class="prop-title">{{ item.title }}</h4>
                        <p class="price-value">{{ formatPrice(item.startingPrice) }}</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Loading State -->
    <!-- Loading State -->
    <div class="loading-overlay" *ngIf="isLoading">
        <div class="spinner-border text-gold" role="status"></div>
    </div>
</div>