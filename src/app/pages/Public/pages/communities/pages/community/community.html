<div class="community-page">

  <header class="page-header">
    <small>Welcome at NYC360</small>
    <h1>Community</h1>
    <p>Where New Yorkers can share ideas, discussions, and local conversations</p>

    <div class="header-nav-buttons">
      <!-- <a routerLink="/public/feed/community" class="nav-btn">Feed</a> -->
      <a routerLink="/public/discover" class="nav-btn">Explore </a>
      <a routerLink="/public/initiatives/community" class="nav-btn">Initiatives</a>

      <!-- Nested Dropdown -->
      <div class="nav-dropdown-complex">
        <button class="nav-btn dropdown-toggle-btn" (click)="toggleActivityDropdown($event)"
          [class.active]="isActivityDropdownOpen">
          <i class="bi bi-person-fill-gear me-2"></i> Contributor Activity <i class="bi bi-chevron-down ms-2"
            style="font-size: 0.8em;"></i>
        </button>
        <div class="dropdown-menu-main" [class.show]="isActivityDropdownOpen" (click)="$event.stopPropagation()">

          <!-- Nested Group 1 -->
          <div class="dropdown-nested-item">
            <div class="item-trigger" (click)="toggleSubMenu('publish', $event)"
              [class.active-sub]="activeSubMenu === 'publish'">
              <span><i class="bi bi-newspaper me-2"></i>Publish News Article</span>
              <i class="bi bi-chevron-right small-arrow"></i>
            </div>
            <div class="dropdown-submenu" [class.show]="activeSubMenu === 'publish'">
              <a routerLink="/public/posts/create" [queryParams]="{type: 'announcement'}" class="sub-item">Create
                Community Announcement</a>
              <a routerLink="/public/posts/create" [queryParams]="{type: 'initiative'}" class="sub-item">Create Local
                Initiative</a>
            </div>
          </div>

          <!-- Simple Item -->
          <a routerLink="/public/rss/connect" class="simple-item">
            <i class="bi bi-rss me-2"></i> Connect RSS Feed
          </a>

          <!-- Nested Group 2 -->
          <div class="dropdown-nested-item">
            <div class="item-trigger" (click)="toggleSubMenu('community', $event)"
              [class.active-sub]="activeSubMenu === 'community'">
              <span><i class="bi bi-people me-2"></i>Create Community</span>
              <i class="bi bi-chevron-right small-arrow"></i>
            </div>
            <div class="dropdown-submenu" [class.show]="activeSubMenu === 'community'">
              <a routerLink="/public/community/moderate" class="sub-item">Moderate Community Threads</a>
            </div>
          </div>

        </div>
      </div>

      <a routerLink="/public/my-communities" class="nav-btn">My Communities</a>
      <a routerLink="/public/create-community" class="nav-btn">Create Community</a>
      <a routerLink="/public/posts/create" class="nav-btn">Create Post</a>
    </div>
  </header>

  <div class="content-wrapper">

    <section class="featured-section" *ngIf="featuredPost && featuredPost.attachments.length > 0">
      <div class="featured-card">
        <div class="feat-img">
          <img
            [src]="featuredPost.attachments.length ? resolvePostImage(featuredPost.attachments[0].url) : 'assets/images/nyc-city.jpg'"
            alt="Featured" [routerLink]="['/public/post', featuredPost.id]" style="cursor: pointer;">
        </div>
        <div class="feat-content">
          <div class="tags-row">
            <span class="badge-orange">COMMUNITY HIGHLIGHT</span>
            <span class="read-time">4 min read</span>
          </div>
          <h2 [routerLink]="['/public/post', featuredPost.id]" style="cursor: pointer;">
            {{ featuredPost.title }}
          </h2>
          <p>{{ featuredPost.content | slice:0:150 }}...</p>
          <button class="btn-read-full" [routerLink]="['/public/post', featuredPost.id]">Read Full Article</button>
        </div>
      </div>
    </section>

    <section class="discover-banner">
      <div class="banner-head">
        <div class="head-text">
          <h2>Discover Communities</h2>
          <p>Connect with your neighbors and New Yorkers who match your interests</p>
        </div>

        <button class="btn-see-more" routerLink="/public/discover">
          See All Communities <i class="bi bi-arrow-right"></i>
        </button>
      </div>

      <div class="cards-scroller">
        <div class="comm-card" *ngFor="let comm of suggestions">
          <div class="card-top">
            <img [src]="resolveCommunityAvatar(comm.avatarUrl)" class="comm-avatar"
              [routerLink]="['/public/community', comm.slug]" style="cursor: pointer;">
            <div class="comm-info">
              <h4 [routerLink]="['/public/community', comm.slug]" style="cursor: pointer;">
                {{ comm.name }}
              </h4>
              <span>{{ comm.memberCount }} Members</span>
            </div>
          </div>

          <button class="btn-join" [class.joined]="comm.isJoined" (click)="joinCommunity(comm)"
            [disabled]="comm.isLoadingJoin || comm.isJoined">
            <ng-container *ngIf="!comm.isJoined && !comm.isLoadingJoin">Join Community</ng-container>
            <ng-container *ngIf="comm.isLoadingJoin">Joining...</ng-container>
            <ng-container *ngIf="comm.isJoined"><i class="bi bi-check-lg"></i> Joined</ng-container>
          </button>
        </div>

        <div class="empty-msg" *ngIf="suggestions.length === 0 && !isLoading">
          No suggested communities at the moment.
        </div>
      </div>
    </section>

    <!-- Text-Only Featured Post (Moved Down) -->
    <section class="featured-section text-only-mode" *ngIf="featuredPost && featuredPost.attachments.length === 0">
      <div class="featured-card">
        <div class="feat-content w-100" style="padding: 40px; text-align: left;">
          <div class="tags-row">
            <span class="badge-orange" style="background: #e3f2fd; color: #1976d2;">LATEST UPDATE</span>
            <span class="read-time">Text Post</span>
          </div>
          <h2 [routerLink]="['/public/post', featuredPost.id]" style="cursor: pointer; font-size: 2rem;">
            {{ featuredPost.title }}
          </h2>
          <p style="font-size: 1.1rem; color: #444;">{{ featuredPost.content | slice:0:300 }}...</p>
          <button class="btn-read-full" [routerLink]="['/public/post', featuredPost.id]"
            style="background: transparent; border: 2px solid #BC5E3D; color: #BC5E3D; box-shadow: none;">
            Read Full Article <i class="bi bi-arrow-right ms-2"></i>
          </button>
        </div>
      </div>
    </section>



    <section class="create-cta">
      <h2>Donâ€™t find a community for your needs?</h2>
      <p>Take the lead in your neighborhood. Start a new discussion group focused on the topics that matter most to you
      </p>
      <button class="btn-create" routerLink="/public/create-community">Create a Community</button>
    </section>

  </div>

</div>