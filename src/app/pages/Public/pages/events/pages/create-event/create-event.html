<div class="create-event-wrapper animate__animated animate__fadeIn">
    <div class="container-fluid px-0">
        <div class="row g-0">

            <!-- Left Column: Live Preview Sticky (Moved from Right to Left) -->
            <div class="col-lg-4 preview-column bg-light-gray d-none d-lg-block">
                <div class="sticky-preview p-5">
                    <div class="preview-header mb-4 text-center">
                        <h5 class="preview-label m-0">LIVE PREVIEW</h5>
                        <small class="text-muted italic">See how NYC sees your event</small>
                    </div>

                    <div class="preview-card bg-white shadow-lg overflow-hidden animate__animated animate__fadeInLeft">
                        <!-- Banner Preview -->
                        <div class="preview-banner">
                            <img [src]="bannerPreviewUrl || 'assets/images/placeholder-event.jpg'" alt="Event Banner"
                                class="img-fluid w-100 h-100 object-fit-cover">
                            <div class="preview-category-badge" *ngIf="eventForm.get('Category')?.value">
                                <i [className]="'bi ' + getCategoryIcon(eventForm.get('Category')?.value)"></i>
                                {{ getCategoryName(eventForm.get('Category')?.value) }}
                            </div>
                        </div>

                        <!-- Content Preview -->
                        <div class="preview-content p-4">
                            <div class="preview-date text-gold fw-bold small text-uppercase mb-2">
                                <i class="bi bi-calendar-check me-1"></i>
                                {{ (eventForm.get('StartDateTime')?.value | date:'MMM d, y, h:mm a') || 'Select Date &
                                Time' }}
                            </div>

                            <h2 class="preview-title text-navy fw-bold mb-3">
                                {{ eventForm.get('Title')?.value || 'The Next Big Event Name' }}
                            </h2>

                            <div class="preview-venue text-muted small mb-4">
                                <i class="bi bi-geo-alt-fill me-1"></i>
                                {{ eventForm.get('VenueName')?.value || 'Choose a Venue' }}
                            </div>

                            <div
                                class="preview-footer d-flex justify-content-between align-items-center border-top pt-3">
                                <div class="preview-pricing">
                                    <span class="text-muted small">Tickets from</span>
                                    <div class="text-navy fw-bold h4 m-0">
                                        ${{ getMinPrice() }}
                                        <span class="h6 text-muted fw-normal" *ngIf="getMaxPrice() > getMinPrice()"> -
                                            ${{ getMaxPrice() }}</span>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-navy-sm rounded-pill disabled">Get Tickets</button>
                            </div>
                        </div>
                    </div>

                    <div class="preview-hint mt-5 text-center px-4">
                        <div class="hint-card p-3 rounded-4 bg-white border">
                            <i class="bi bi-info-circle-fill text-gold mb-2 h4 d-block"></i>
                            <p class="text-muted small mb-0">Changes update instantly as you type. Ensure your title is
                                catchy!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Form (Main Content) -->
            <div class="col-lg-8 form-scroll-area">
                <div class="form-container p-4 p-md-5">

                    <!-- Page Header -->
                    <div class="form-header mb-5">
                        <h1 class="display-5 fw-bold text-navy">Create New <span class="text-gold">Event</span></h1>
                        <p class="lead text-muted">Fill in the details below. Our live preview will show you exactly how
                            it will look on NYC360.</p>
                    </div>

                    <form [formGroup]="eventForm" (ngSubmit)="onSubmit()" class="event-form">

                        <!-- Section 1: Basic Info -->
                        <div class="form-section-card mb-5 animate__animated animate__fadeInUp">
                            <h3 class="section-title"><i class="bi bi-info-circle-fill text-gold me-2"></i> 1. Basic
                                Information</h3>
                            <div class="row g-4">
                                <div class="col-12">
                                    <div class="form-floating shadow-sm rounded-4">
                                        <input type="text" class="form-control border-0" id="title"
                                            formControlName="Title" placeholder="Event Title">
                                        <label for="title">Event Title *</label>
                                    </div>
                                    <div *ngIf="eventForm.get('Title')?.touched && eventForm.get('Title')?.invalid"
                                        class="text-danger small mt-2 ps-2">
                                        <i class="bi bi-exclamation-circle me-1"></i> Start with a catchy title.
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-floating shadow-sm rounded-4">
                                        <select class="form-select border-0" id="category" formControlName="Category">
                                            <option [ngValue]="null" disabled>Select Category</option>
                                            <option *ngFor="let cat of categories" [value]="cat.id">{{cat.name}}
                                            </option>
                                        </select>
                                        <label for="category">Category *</label>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-floating shadow-sm rounded-4">
                                        <select class="form-select border-0" id="visibility"
                                            formControlName="Visibility">
                                            <option *ngFor="let opt of visibilityOptions" [value]="opt.id">{{opt.name}}
                                            </option>
                                        </select>
                                        <label for="visibility">Visibility *</label>
                                    </div>
                                </div>

                                <div class="col-md-6" *ngIf="eventForm.get('Visibility')?.value == 4">
                                    <div class="form-floating shadow-sm rounded-4 animate__animated animate__fadeIn">
                                        <input type="password" class="form-control border-0" id="password"
                                            formControlName="AccessPassword" placeholder="Access Password">
                                        <label for="password">Access Password *</label>
                                    </div>
                                </div>

                                <div class="col-12">
                                    <div class="form-floating shadow-sm rounded-4">
                                        <textarea class="form-control border-0" placeholder="Description"
                                            id="description" formControlName="Description"
                                            style="height: 180px"></textarea>
                                        <label for="description">Tell the story of your event... *</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Section 2: Venue & Time -->
                        <div class="form-section-card mb-5 animate__animated animate__fadeInUp"
                            style="animation-delay: 0.1s">
                            <h3 class="section-title"><i class="bi bi-geo-alt-fill text-gold me-2"></i> 2. Location &
                                Time</h3>
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="form-floating shadow-sm rounded-4">
                                        <input type="datetime-local" class="form-control border-0" id="start-date"
                                            formControlName="StartDateTime">
                                        <label for="start-date">Starts *</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating shadow-sm rounded-4">
                                        <input type="datetime-local" class="form-control border-0" id="end-date"
                                            formControlName="EndDateTime">
                                        <label for="end-date">Ends *</label>
                                    </div>
                                </div>

                                <div class="col-12">
                                    <div class="form-floating shadow-sm rounded-4">
                                        <input type="text" class="form-control border-0" id="venue"
                                            formControlName="VenueName" placeholder="Venue Name">
                                        <label for="venue">Venue Name *</label>
                                    </div>
                                </div>

                                <div formGroupName="Address" class="row g-4 m-0 p-0 mb-4">
                                    <div class="col-md-6 p-0 pe-md-2 mb-3 mb-md-0">
                                        <div class="form-floating shadow-sm rounded-4">
                                            <input type="text" class="form-control border-0" id="street"
                                                formControlName="Street" placeholder="Street">
                                            <label for="street">Street Address *</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3 p-0 px-md-2 mb-3 mb-md-0">
                                        <div class="form-floating shadow-sm rounded-4">
                                            <input type="text" class="form-control border-0" id="building"
                                                formControlName="BuildingNumber" placeholder="Bldg #">
                                            <label for="building">Bldg #</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3 p-0 ps-md-2">
                                        <div class="form-floating shadow-sm rounded-4">
                                            <input type="text" class="form-control border-0" id="zipcode"
                                                formControlName="ZipCode" placeholder="Zip Code">
                                            <label for="zipcode">Zip Code *</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Section 3: Tickets -->
                        <div class="form-section-card mb-5 animate__animated animate__fadeInUp"
                            style="animation-delay: 0.2s">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h3 class="section-title m-0"><i class="bi bi-tags-fill text-gold me-2"></i> 3. Tickets
                                </h3>
                                <button type="button" class="btn btn-navy-sm rounded-pill" (click)="addTier()">
                                    <i class="bi bi-plus-lg me-1"></i> Add Another Tier
                                </button>
                            </div>

                            <div formArrayName="Tiers" class="d-flex flex-column gap-3">
                                <div *ngFor="let tier of tiers.controls; let i = index" [formGroupName]="i"
                                    class="tier-input-card p-3 rounded-4 bg-light shadow-sm position-relative">
                                    <button type="button" class="btn-close position-absolute top-0 end-0 m-3"
                                        (click)="removeTier(i)" *ngIf="tiers.length > 1"></button>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="small text-muted mb-1 ps-1">Tier Name</label>
                                            <input type="text" class="form-control form-control-sm border-0 shadow-sm"
                                                formControlName="Name" placeholder="e.g. Early Bird, VIP">
                                        </div>
                                        <div class="col-md-3">
                                            <label class="small text-muted mb-1 ps-1">Price</label>
                                            <div class="input-group input-group-sm shadow-sm rounded-3 overflow-hidden">
                                                <span class="input-group-text bg-white border-0">$</span>
                                                <input type="number" class="form-control border-0"
                                                    formControlName="Price" placeholder="0.00">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="small text-muted mb-1 ps-1">Qty Available</label>
                                            <input type="number" class="form-control form-control-sm border-0 shadow-sm"
                                                formControlName="QuantityAvailable" placeholder="10">
                                        </div>
                                        <div class="col-12 mt-2">
                                            <input type="text" class="form-control form-control-sm border-0 shadow-sm"
                                                formControlName="Description"
                                                placeholder="Short description of what this ticket includes...">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Section 4: Media -->
                        <div class="form-section-card mb-5 animate__animated animate__fadeInUp"
                            style="animation-delay: 0.3s">
                            <h3 class="section-title"><i class="bi bi-image-fill text-gold me-2"></i> 4. Media</h3>
                            <div class="upload-area border-dashed text-center p-5 rounded-4 bg-white shadow-sm"
                                (click)="fileInput.click()" (dragover)="$event.preventDefault()"
                                (drop)="onFileDrop($event)">
                                <input type="file" #fileInput class="d-none" multiple (change)="onFileSelect($event)"
                                    accept="image/*">
                                <i class="bi bi-cloud-arrow-up-fill display-4 text-navy"></i>
                                <h4 class="mt-3">Upload Event Banner</h4>
                                <p class="text-muted small">Recommended size: 2160 x 1080px (2:1 ratio). Max 5MB.</p>

                                <div class="file-previews d-flex flex-wrap gap-2 mt-4" *ngIf="selectedFiles.length > 0">
                                    <div *ngFor="let file of selectedFiles; let i = index"
                                        class="file-chip bg-navy text-white px-3 py-1 rounded-pill animate__animated animate__scaleIn">
                                        <span class="small">{{file.name}}</span>
                                        <i class="bi bi-x-circle ms-2 cursor-pointer"
                                            (click)="$event.stopPropagation(); removeFile(i)"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions text-center mt-5 mb-5 pb-5 animate__animated animate__fadeInUp"
                            style="animation-delay: 0.4s">
                            <button type="submit" class="btn btn-navy-lg rounded-pill fw-bold w-100 py-3 shadow-lg"
                                [disabled]="isSubmitting">
                                <span *ngIf="!isSubmitting">Publish Your Event Now <i
                                        class="bi bi-rocket-takeoff ms-2"></i></span>
                                <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
                                <span *ngIf="isSubmitting">Processing...</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>