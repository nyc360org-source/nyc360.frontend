<div class="events-list-wrapper animate__animated animate__fadeIn">
    <!-- Hero Section -->
    <header class="events-hero py-5 mb-4">
        <div class="container text-center">
            <h1 class="display-3 fw-bold text-navy mb-3">Event <span class="text-gold">Feed</span></h1>
            <p class="lead text-muted mb-5">NY vibes, powered by the community. Real-time updates.</p>

            <!-- Search Bar -->
            <div class="search-box mx-auto shadow-lg rounded-pill p-2 bg-white d-flex align-items-center mb-4">
                <i class="bi bi-search ms-3 text-muted"></i>
                <input type="text" class="form-control border-0 bg-transparent ms-2" [(ngModel)]="searchTerm"
                    (keyup.enter)="onSearch()" placeholder="Search festivals, concerts, pop-ups...">
                <button class="btn btn-purple rounded-pill px-4 ms-2" (click)="onSearch()">Search</button>
            </div>

            <!-- Category Pills -->
            <div class="category-pills d-flex flex-wrap justify-content-center gap-2 mb-4">
                <button *ngFor="let cat of categories" class="btn category-pill"
                    [class.active]="selectedCategory === cat.id" (click)="selectCategory(cat.id)">
                    <i [class]="'bi ' + cat.icon + ' me-1'"></i> {{cat.name}}
                </button>
            </div>

            <!-- Advanced Filters -->
            <div class="advanced-filters container d-flex flex-wrap justify-content-center gap-3">
                <div class="filter-item">
                    <select class="form-select rounded-pill border-0 shadow-sm px-4" [(ngModel)]="selectedLocation"
                        (change)="onFilterChange()">
                        <option [ngValue]="null">Select Neighborhood</option>
                        <option *ngFor="let loc of locations" [ngValue]="loc.id">{{loc.borough}} - {{loc.neighborhood}}
                        </option>
                    </select>
                </div>
                <div class="filter-item">
                    <select class="form-select rounded-pill border-0 shadow-sm px-4" [(ngModel)]="selectedStatus"
                        (change)="onFilterChange()">
                        <option [ngValue]="null">Any Status</option>
                        <option *ngFor="let status of statuses" [ngValue]="status.id">{{status.name}}</option>
                    </select>
                </div>
            </div>
        </div>
    </header>

    <div class="container pb-5">
        <!-- Results Info -->
        <div class="d-flex justify-content-between align-items-center mb-4 px-2">
            <h4 class="fw-bold m-0" *ngIf="!isLoading"> <i class="bi bi-broadcast text-purple me-2"></i> {{totalCount}}
                Events Live</h4>
            <div class="pagination-summary" *ngIf="!isLoading && totalPages > 1">
                <span class="text-muted small">Page {{pageNumber}} of {{totalPages}}</span>
            </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="text-center py-5">
            <div class="spinner-border text-purple" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3 text-muted opacity-75">Syncing with NYC server...</p>
        </div>

        <!-- Events Grid -->
        <div class="row g-4" *ngIf="!isLoading">
            <div class="col-md-6 col-lg-4 animate__animated animate__fadeInUp"
                *ngFor="let event of events; let i = index" [style.animation-delay]="(i * 0.1) + 's'">

                <div class="event-card h-100 bg-white rounded-4 overflow-hidden border-0 shadow-sm"
                    [routerLink]="['/public/events/details', event.id]">

                    <div class="event-img-container" [class.no-img]="!event.imageUrl">
                        <!-- Pulling strictly from backend events folder -->
                        <img *ngIf="event.imageUrl" [src]="event.imageUrl" class="event-img w-100 object-fit-cover"
                            alt="Event">

                        <!-- Premium fallback if no image from backend -->
                        <div *ngIf="!event.imageUrl"
                            class="no-img-placeholder d-flex align-items-center justify-content-center">
                            <i class="bi bi-image text-purple opacity-25 display-4"></i>
                        </div>

                        <div class="event-category-badge">
                            <i [class]="'bi ' + getCategoryIcon(event.category)"></i>
                            {{getCategoryName(event.category)}}
                        </div>
                        <div class="event-price-tag" [class.free]="event.priceStart === 0">
                            {{getPriceDisplay(event)}}
                        </div>
                    </div>

                    <div class="event-body p-4">
                        <div class="event-date text-gold fw-bold small text-uppercase mb-2">
                            <i class="bi bi-calendar3 me-1"></i>
                            {{event.startDateTime | date:'EEE, MMM d â€¢ h:mm a'}}
                        </div>
                        <h5 class="event-title fw-bold text-navy mb-3 line-clamp-2">{{event.title}}</h5>
                        <div class="event-venue text-muted small mt-auto">
                            <i class="bi bi-geo-alt-fill me-1 text-purple"></i>
                            <span *ngIf="event.venue">{{event.venue.location.borough}} -
                                {{event.venue.location.neighborhood}}</span>
                            <span *ngIf="!event.venue && event.type === 1">Online Stream</span>
                            <span *ngIf="!event.venue && event.type !== 1">To Be Announced</span>
                        </div>
                    </div>

                    <div
                        class="event-footer px-4 py-3 border-top d-flex justify-content-between align-items-center bg-light-purple">
                        <div class="d-flex align-items-center" *ngIf="event.primaryOrganizer">
                            <!-- <img [src]="event.primaryOrganizer.imageUrl" *ngIf="event.primaryOrganizer.imageUrl"
                                class="rounded-circle me-2 border border-2 border-white" width="32" height="32"
                                alt="Org"> -->

                            <div *ngIf="!event.primaryOrganizer.imageUrl"
                                class="user-avatar-mini me-2 d-flex align-items-center justify-content-center bg-purple-soft rounded-circle">
                                <i class="bi bi-person text-purple small"></i>
                            </div>

                            <span class="small text-navy fw-bold">{{event.primaryOrganizer.fullName}}</span>
                        </div>
                        <div class="event-status-badge small text-uppercase fw-bold shadow-sm"
                            [ngClass]="'status-' + event.status">
                            {{statuses[event.status]?.name || 'Live'}}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <nav class="mt-5 d-flex justify-content-center" *ngIf="!isLoading && totalPages > 1">
            <ul class="pagination pagination-md shadow-sm border-0">
                <li class="page-item" [class.disabled]="pageNumber === 1">
                    <a class="page-link border-0 px-3 bg-white text-purple" (click)="changePage(pageNumber - 1)">
                        <i class="bi bi-chevron-left"></i>
                    </a>
                </li>
                <li class="page-item active"><a class="page-link border-0 px-4 bg-purple text-white">{{pageNumber}}</a>
                </li>
                <li class="page-item" [class.disabled]="pageNumber === totalPages">
                    <a class="page-link border-0 px-4 bg-white text-purple" (click)="changePage(pageNumber + 1)">
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Empty State -->
        <div *ngIf="!isLoading && events.length === 0" class="text-center py-5">
            <div class="empty-state-icon mb-4">
                <i class="bi bi-database-exclamation display-1 text-light-purple"></i>
            </div>
            <h3 class="text-navy fw-bold">Connecting to Cloud...</h3>
            <p class="text-muted">No data returned from the server for this query.</p>
            <button class="btn btn-purple rounded-pill mt-3 px-5 py-2 fw-bold"
                (click)="searchTerm = ''; selectedCategory = null; selectedLocation=null; selectedStatus=null; fetchEvents()">Refresh
                Stream</button>
        </div>
    </div>

    <!-- Featured Hosting CTA -->
    <section class="events-cta py-5 bg-purple text-white text-center rounded-4 mx-2 mb-5">
        <div class="container py-4">
            <h2 class="fw-bold mb-3 display-6">Have an event to show?</h2>
            <p class="mb-4 opacity-90 fs-5">Broadcast your event to the whole NYC360 network.</p>
            <button class="btn btn-white bg-white text-purple rounded-pill px-5 py-3 fw-bold shadow-lg border-0"
                routerLink="/public/events/create">
                LIST YOUR EVENT <i class="bi bi-plus-lg ms-2"></i>
            </button>
        </div>
    </section>
</div>