<div class="profession-feed-page">

  <header class="page-header">
    <div class="header-content text-center">
      <small class="text-uppercase tracking-wider">Welcome at NYC360</small>
      <h1 class="merriweather-font display-4 fw-bold my-3">Profession</h1>
      <p class="lead mx-auto" style="max-width: 650px;">
        Opportunities, career insights, and professional life in New York City.
      </p>

      <div class="header-nav-buttons">
        <a routerLink="/public/profession/jobs" class="nav-btn">Explore</a>
        <a routerLink="/public/profession/my-applications" class="nav-btn">My Inquiries</a>
        <a routerLink="/public/profession/my-offers" class="nav-btn">My Offers</a>

        <!-- Contributor Activity Dropdown -->
        <div class="nav-dropdown-complex" style="position: relative; display: inline-block;">
          <button class="nav-btn dropdown-toggle-btn" (click)="toggleActivityDropdown($event)"
            [class.active]="isActivityDropdownOpen"
            style="border: 1px solid #00695C; background: #00695C; color: white;">
            <i class="bi bi-person-fill-gear me-2"></i> Contributor Activity <i class="bi bi-chevron-down ms-2"
              style="font-size: 0.8em;"></i>
          </button>

          <div class="dropdown-menu-main" *ngIf="isActivityDropdownOpen" style="
                 position: absolute; 
                 top: 100%; 
                 left: 50%; 
                 transform: translateX(-50%); 
                 background: white; 
                 min-width: 260px; 
                 border-radius: 12px; 
                 box-shadow: 0 10px 40px rgba(0,0,0,0.15); 
                 margin-top: 10px; 
                 z-index: 1000;
                 padding: 8px 0;
                 border: 1px solid rgba(0,0,0,0.05);">

            <!-- Publish News -->
            <ng-container *ngIf="hasProfessionAccess; else lockedNews">
              <a routerLink="/public/posts/create" class="simple-item"
                style="display: flex; align-items: center; padding: 12px 20px; color: #333; text-decoration: none;">
                <i class="bi bi-newspaper me-2" style="color: #00695C;"></i>Publish News Article
              </a>
            </ng-container>
            <ng-template #lockedNews>
              <div class="simple-item locked" (click)="openVerificationModal()"
                style="display: flex; justify-content: space-between; align-items: center; padding: 12px 20px; color: #aaa; cursor: pointer;">
                <div class="d-flex align-items-center">
                  <i class="bi bi-newspaper me-2"></i>Publish News Article
                </div>
                <i class="bi bi-lock-fill ms-2" style="font-size: 0.9em; opacity: 0.6;"></i>
              </div>
            </ng-template>

            <!-- Connect RSS -->
            <ng-container *ngIf="hasProfessionAccess; else lockedRSS">
              <a routerLink="/public/rss/connect" class="simple-item"
                style="display: flex; align-items: center; padding: 12px 20px; color: #333; text-decoration: none;">
                <i class="bi bi-rss me-2" style="color: #00695C;"></i> Connect RSS Feed
              </a>
            </ng-container>
            <ng-template #lockedRSS>
              <div class="simple-item locked" (click)="openVerificationModal()"
                style="display: flex; justify-content: space-between; align-items: center; padding: 12px 20px; color: #aaa; cursor: pointer;">
                <div class="d-flex align-items-center">
                  <i class="bi bi-rss me-2"></i> Connect RSS Feed
                </div>
                <i class="bi bi-lock-fill ms-2" style="font-size: 0.9em; opacity: 0.6;"></i>
              </div>
            </ng-template>

          </div>
        </div>

        <a routerLink="/public/forums/professions" class="nav-btn">Ask a Question</a>
      </div>
    </div>
  </header>

  <div class="container py-5" *ngIf="!isLoading">

    <!-- Hero Article (Visual or Shared) -->
    <section class="mb-5" *ngIf="heroArticle">
      <!-- Regular Hero -->
      <app-article-hero *ngIf="!heroArticle.parentPost" [image]="getArticleImage(heroArticle)"
        [title]="heroArticle.title" [description]="heroArticle.content"
        [metaText]="'Published: ' + (heroArticle.createdAt | date:'MMM d, y')"
        [link]="['/public/posts/details', heroArticle.id]" [customColor]="'#00695C'">
      </app-article-hero>

      <!-- Shared Hero LinkedIn Style -->
      <div class="text-card-design p-4 shadow-sm" *ngIf="heroArticle.parentPost"
        [routerLink]="['/public/posts/details', heroArticle.id]"
        style="cursor: pointer; border-left: 8px solid #00695C; max-width: 1000px; margin: 0 auto;">
        <div class="card-top-row">
          <span class="pill-tag" style="background: #00695C; color: white;">FEATURED SHARE</span>
          <span class="post-time">{{ heroArticle.createdAt | date:'MMM d, y' }}</span>
        </div>
        <h2 class="merriweather-font mb-3" style="font-size: 1.8rem;">{{ heroArticle.title }}</h2>
        <p class="mb-4" *ngIf="heroArticle.content">{{ heroArticle.content }}</p>

        <div class="shared-post-box">
          <div class="shared-header">
            <img [src]="getAuthorAvatar(heroArticle.parentPost.author)" class="shared-avatar" alt="Avatar"
              appImgFallback="avatar">
            <div class="author-info">
              <span class="author-name">{{ heroArticle.parentPost.author.name || heroArticle.parentPost.author.fullName
                ||
                heroArticle.parentPost.author.username }}</span>
              <span class="post-date">{{ heroArticle.parentPost.createdAt | date:'mediumDate' }}</span>
            </div>
          </div>
          <div class="shared-img-wrapper"
            *ngIf="imageService.resolvePostImage(heroArticle.parentPost) !== imageService.DEFAULT_POST">
            <img [src]="getArticleImage(heroArticle.parentPost)" alt="Shared Image" appImgFallback="post">
          </div>
          <div class="shared-content">
            <h4 class="merriweather-font" *ngIf="heroArticle.parentPost.title">{{ heroArticle.parentPost.title }}</h4>
            <p>{{ heroArticle.parentPost.content }}</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Visual Grid Articles -->
    <section class="mt-5" *ngIf="visualArticles.length > 0">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="merriweather-font h3 border-start border-4 border-success ps-3">Career Path Articles</h2>
      </div>

      <div class="row g-4">
        <div class="col-lg-4 col-md-6" *ngFor="let article of visualArticles">
          <!-- Regular Grid Card -->
          <app-article-grid-card *ngIf="!article.parentPost" [image]="getArticleImage(article)" [title]="article.title"
            [description]="article.content" [link]="['/public/posts/details', article.id]" [customColor]="'#26A69A'">
          </app-article-grid-card>

          <!-- Shared Grid Card LinkedIn Style -->
          <div class="text-card-design p-3 h-100" *ngIf="article.parentPost"
            [routerLink]="['/public/posts/details', article.id]" style="cursor: pointer;">
            <div class="card-top-row">
              <span class="pill-tag">SHARED</span>
              <span class="post-time">{{ article.createdAt | date:'shortDate' }}</span>
            </div>
            <h4 class="merriweather-font mb-2" style="font-size: 1.1rem; font-weight: 700;">{{ article.title |
              slice:0:60 }}</h4>

            <div class="shared-post-box mt-2" style="transform: scale(0.95); margin-left: -2.5%; width: 105%;">
              <div class="shared-header py-1 px-2">
                <img [src]="getAuthorAvatar(article.parentPost.author)" class="shared-avatar"
                  style="width: 18px; height: 18px;" appImgFallback="avatar">
                <div class="author-info">
                  <span class="author-name" style="font-size: 0.75rem;">{{ article.parentPost.author.name ||
                    article.parentPost.author.username }}</span>
                </div>
              </div>
              <div class="shared-img-wrapper" style="max-height: 140px;"
                *ngIf="imageService.resolvePostImage(article.parentPost) !== imageService.DEFAULT_POST">
                <img [src]="getArticleImage(article.parentPost)" alt="Shared" appImgFallback="post">
              </div>
              <div class="shared-content p-2">
                <p
                  style="font-size: 0.8rem; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                  {{ article.parentPost.content }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Text-Only Articles (Bottom Section) -->
    <section class="text-only-section mt-5 fade-in-up" *ngIf="textArticles.length > 0">
      <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-2">
        <h2 class="merriweather-font h3 text-dark">Community Updates</h2>
        <!-- <span class="badge bg-light text-dark">{{ textArticles.length }} New</span> -->
      </div>

      <div class="row g-4">
        <div class="col-md-6" *ngFor="let post of textArticles">
          <div class="text-card-design" [routerLink]="['/public/posts/details', post.id]" style="cursor: pointer;">
            <div class="card-top-row">
              <span class="pill-tag">PROFESSION</span>
              <span class="post-time">{{ post.createdAt | date:'shortTime' }} ago</span>
            </div>
            <h3 class="text-title" *ngIf="post.title">“{{ post.title }}”</h3>
            <p class="text-excerpt" *ngIf="post.content">{{ post.content | slice:0:120 }}{{ post.content.length > 120 ?
              '...' : '' }}</p>

            <!-- LinkedIn Style Shared Post Box -->
            <div class="shared-post-box" *ngIf="post.parentPost">
              <div class="shared-header">
                <img [src]="getAuthorAvatar(post.parentPost.author)" class="shared-avatar" alt="Avatar"
                  appImgFallback="avatar">
                <div class="author-info">
                  <span class="author-name">{{ post.parentPost.author.name || post.parentPost.author.fullName ||
                    post.parentPost.author.username }}</span>
                  <span class="post-date">{{ post.parentPost.createdAt | date:'mediumDate' }}</span>
                </div>
              </div>
              <div class="shared-img-wrapper"
                *ngIf="imageService.resolvePostImage(post.parentPost) !== imageService.DEFAULT_POST">
                <img [src]="getArticleImage(post.parentPost)" alt="Shared Image" appImgFallback="post">
              </div>
              <div class="shared-content">
                <h4 *ngIf="post.parentPost.title">{{ post.parentPost.title }}</h4>
                <p>{{ post.parentPost.content }}</p>
              </div>
            </div>

            <div class="card-footer-meta mt-3">
              <div class="author-group">
                <img [src]="getAuthorAvatar(post.author)" class="mini-avatar" appImgFallback="avatar">
                <span>{{ post.author.fullName || post.author.username || 'Member' }}</span>
              </div>
              <span class="read-more-link">Read <i class="bi bi-arrow-right"></i></span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Hiring News - High Impact Section -->
    <section class="hiring-premium-section mt-5" *ngIf="hiringNews.length > 0">
      <div class="section-overlay-blob"></div>

      <div class="section-header-row mb-5">
        <div class="title-group">
          <span class="premium-badge">OPPORTUNITIES</span>
          <h2 class="merriweather-font display-6 fw-bold">NYC Hiring Spotlight</h2>
          <p>Hand-picked roles from NYC's most innovative companies.</p>
        </div>
        <a routerLink="/public/profession/jobs" class="luxury-btn-primary">
          <span>View All Roles</span>
          <i class="bi bi-arrow-right"></i>
        </a>
      </div>

      <div class="row g-4 justify-content-center">
        <div class="col-md-6 col-lg-5" *ngFor="let job of hiringNews">
          <div class="premium-job-card" [routerLink]="['/public/job-profile', job.id]">
            <div class="card-inner">
              <div class="job-meta-top">
                <div class="company-brand">
                  <img [src]="imageService.resolveAvatar({imageUrl: job.authorAvatarUrl})" class="brand-logo"
                    appImgFallback="avatar">
                  <div class="brand-info">
                    <span class="company-name">{{ job.companyName }}</span>
                    <span class="post-date">Recently Posted</span>
                  </div>
                </div>
                <div class="arrangement-tag" [attr.data-type]="getWorkArrangement(job.workArrangement)">
                  <i class="bi" [ngClass]="{
                    'bi-house-heart': job.workArrangement === 1,
                    'bi-building': job.workArrangement === 0,
                    'bi-door-open': job.workArrangement === 2
                  }"></i>
                  {{ getWorkArrangement(job.workArrangement) }}
                </div>
              </div>

              <h3 class="job-title">{{ job.title }}</h3>

              <div class="job-details-grid">
                <div class="detail-item">
                  <i class="bi bi-cash-stack"></i>
                  <span>{{ formatSalary(job.salaryMin, job.salaryMax) }}</span>
                </div>
                <div class="detail-item">
                  <i class="bi bi-briefcase"></i>
                  <span>{{ getEmploymentType(job.employmentType) }}</span>
                </div>
                <div class="detail-item">
                  <i class="bi bi-graph-up-arrow"></i>
                  <span>{{ getLevel(job.employmentLevel) }}</span>
                </div>
              </div>

              <div class="card-action-bar">
                <div class="applicants-status">
                  <i class="bi bi-lightning-charge-fill text-warning"></i>
                  <span>Actively Recruiting</span>
                </div>
                <button class="btn-apply-small">
                  Details <i class="bi bi-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="text-center py-5" *ngIf="!heroArticle && visualArticles.length === 0 && textArticles.length === 0">
      <p class="text-muted italic">No career articles available at the moment.</p>
    </div>

  </div>

  <app-verification-modal *ngIf="isVerificationModalOpen" [categoryName]="'Profession'" [categoryId]="8"
    (close)="closeVerificationModal()" (verified)="onVerified()">
  </app-verification-modal>

</div>